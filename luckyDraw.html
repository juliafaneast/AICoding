<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹´ä¼šæŠ½å¥–ç³»ç»Ÿ - ä¿®å¤ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #d10000 0%, #9b0000 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .right-panel {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        textarea, input, select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffcc00 0%, #ff9900 100%);
            color: #7a0000;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #a71d2a 100%);
            color: white;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        .lottery-box {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 8px solid #ffcc00;
        }
        
        .lottery-inner {
            width: 80%;
            height: 80%;
            background: linear-gradient(135deg, #9b0000 0%, #7a0000 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ffcc00;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .lottery-inner:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            transform: rotate(30deg);
        }
        
        .result-display {
            width: 100%;
            min-height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .winner-list {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .winner-group {
            margin-bottom: 20px;
        }
        
        .winner-group-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .winner-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .winner-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .prize-tag {
            background: #ffcc00;
            color: #7a0000;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .prize-management {
            margin-top: 20px;
        }
        
        .prize-list {
            margin-top: 15px;
        }
        
        .prize-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .prize-info {
            flex: 1;
        }
        
        .prize-actions {
            display: flex;
            gap: 5px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-row input {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .lottery-box {
                max-width: 300px;
            }
            
            .result-display {
                font-size: 1.5rem;
            }
            
            .form-row {
                flex-direction: column;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .spinning {
            animation: spin 0.2s linear infinite;
        }
        
        .blinking {
            animation: blink 0.5s ease-in-out infinite;
        }
        
        .highlight {
            color: #ffcc00;
            text-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00;
            transition: all 0.5s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #9b0000 0%, #7a0000 100%);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #ffcc00;
        }
        
        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŠ å¹´ä¼šæŠ½å¥–ç³»ç»Ÿ ğŸŠ</h1>
            <div class="subtitle">è‡ªå®šä¹‰å¥–é¡¹ï¼Œåˆ›é€ æƒŠå–œæ—¶åˆ»</div>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <h2 class="section-title">æŠ½å¥–è®¾ç½®</h2>
                
                <div class="input-group">
                    <label for="participants">å‚ä¸äººå‘˜åå•ï¼ˆæ¯è¡Œä¸€ä¸ªåå­—ï¼‰</label>
                    <textarea id="participants" placeholder="è¯·è¾“å…¥å‚ä¸æŠ½å¥–çš„äººå‘˜åå•ï¼Œæ¯è¡Œä¸€ä¸ªåå­—..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="prize-type">é€‰æ‹©å¥–é¡¹</label>
                    <select id="prize-type">
                        <option value="">-- è¯·é€‰æ‹©å¥–é¡¹ --</option>
                    </select>
                </div>
                
                <button id="setup-btn" class="btn">ä¿å­˜è®¾ç½®</button>
                
                <div class="prize-management">
                    <h3 class="section-title">å¥–é¡¹ç®¡ç†</h3>
                    
                    <div class="form-row">
                        <input type="text" id="prize-name" placeholder="å¥–é¡¹åç§°">
                        <input type="number" id="prize-count" placeholder="äººæ•°" min="1">
                    </div>
                    <input type="text" id="prize-desc" placeholder="å¥–å“æè¿°ï¼ˆå¯é€‰ï¼‰">
                    <button id="add-prize-btn" class="btn">æ·»åŠ å¥–é¡¹</button>
                    
                    <div class="prize-list" id="prize-list">
                        <!-- å¥–é¡¹åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="lottery-box">
                    <div class="lottery-inner" id="start-lottery">
                        ç‚¹å‡»å¼€å§‹<br>æŠ½å¥–
                    </div>
                </div>
                
                <div class="result-display" id="result">
                    ç­‰å¾…æŠ½å¥–ç»“æœ...
                </div>
                
                <div class="controls">
                    <button id="reset-btn" class="btn btn-secondary">é‡ç½®æŠ½å¥–</button>
                    <button id="batch-draw-btn" class="btn">æ‰¹é‡æŠ½å–</button>
                    <button id="export-btn" class="btn">å¯¼å‡ºExcel</button>
                </div>
            </div>
        </div>
        
        <div class="winner-list">
            <h2 class="section-title">ä¸­å¥–åå•</h2>
            <div id="winners-container">
                <!-- ä¸­å¥–åå•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                <div class="winner-group">
                    <div class="winner-group-title">
                        <span>æš‚æ— ä¸­å¥–è€…</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡æŠ½å¥–æ¨¡æ€æ¡† -->
    <div class="modal" id="batch-modal">
        <div class="modal-content">
            <h2 class="modal-title">æ‰¹é‡æŠ½å–è®¾ç½®</h2>
            <div class="input-group">
                <label for="batch-count">æŠ½å–äººæ•°</label>
                <input type="number" id="batch-count" min="1" value="3">
            </div>
            <div class="input-group">
                <label for="batch-prize">å¥–é¡¹åç§°</label>
                <input type="text" id="batch-prize" placeholder="è¾“å…¥å¥–é¡¹åç§°">
            </div>
            <div class="modal-buttons">
                <button id="confirm-batch-draw" class="btn">å¼€å§‹æŠ½å–</button>
                <button id="cancel-batch-draw" class="btn btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const participantsTextarea = document.getElementById('participants');
            const prizeTypeSelect = document.getElementById('prize-type');
            const setupBtn = document.getElementById('setup-btn');
            const startLotteryBtn = document.getElementById('start-lottery');
            const resultDisplay = document.getElementById('result');
            const resetBtn = document.getElementById('reset-btn');
            const exportBtn = document.getElementById('export-btn');
            const winnersContainer = document.getElementById('winners-container');
            const addPrizeBtn = document.getElementById('add-prize-btn');
            const prizeNameInput = document.getElementById('prize-name');
            const prizeCountInput = document.getElementById('prize-count');
            const prizeDescInput = document.getElementById('prize-desc');
            const prizeList = document.getElementById('prize-list');
            const batchDrawBtn = document.getElementById('batch-draw-btn');
            const batchModal = document.getElementById('batch-modal');
            const confirmBatchDraw = document.getElementById('confirm-batch-draw');
            const cancelBatchDraw = document.getElementById('cancel-batch-draw');
            const batchCountInput = document.getElementById('batch-count');
            const batchPrizeInput = document.getElementById('batch-prize');
            
            // åˆå§‹åŒ–æ•°æ®
            let participants = [];
            let winners = [];
            let prizes = [];
            let isSpinning = false;
            
            // åˆå§‹åŒ–å¥–é¡¹
            initPrizes();
            
            // åˆå§‹åŒ–å¥–é¡¹
            function initPrizes() {
                // æ·»åŠ é»˜è®¤å¥–é¡¹
                addPrize('ä¸€ç­‰å¥–', 1, 'æœ€æ–°æ¬¾iPhone');
                addPrize('äºŒç­‰å¥–', 3, 'åä¸ºå¹³æ¿ç”µè„‘');
                addPrize('ä¸‰ç­‰å¥–', 5, 'æ™ºèƒ½æ‰‹è¡¨');
                addPrize('å¹¸è¿å¥–', 10, 'è“ç‰™è€³æœº');
                
                updatePrizeSelect();
            }
            
            // æ·»åŠ å¥–é¡¹
            function addPrize(name, count, desc = '') {
                const newPrize = {
                    id: Date.now() + Math.random(), // ç¡®ä¿IDå”¯ä¸€
                    name,
                    count,
                    desc
                };
                prizes.push(newPrize);
                
                renderPrizes();
                updatePrizeSelect();
            }
            
            // åˆ é™¤å¥–é¡¹
            function deletePrize(id) {
                prizes = prizes.filter(prize => prize.id !== id);
                renderPrizes();
                updatePrizeSelect();
            }
            
            // æ¸²æŸ“å¥–é¡¹åˆ—è¡¨
            function renderPrizes() {
                prizeList.innerHTML = '';
                
                if (prizes.length === 0) {
                    prizeList.innerHTML = '<div class="prize-item">æš‚æ— å¥–é¡¹ï¼Œè¯·æ·»åŠ </div>';
                    return;
                }
                
                prizes.forEach(prize => {
                    const prizeElement = document.createElement('div');
                    prizeElement.className = 'prize-item';
                    prizeElement.innerHTML = `
                        <div class="prize-info">
                            <div><strong>${prize.name}</strong> (${prize.count}å)</div>
                            <div>${prize.desc || 'æ— å¥–å“æè¿°'}</div>
                        </div>
                        <div class="prize-actions">
                            <button class="btn btn-danger btn-small btn-delete" data-id="${prize.id}">åˆ é™¤</button>
                        </div>
                    `;
                    prizeList.appendChild(prizeElement);
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
                document.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseFloat(this.getAttribute('data-id'));
                        deletePrize(id);
                    });
                });
            }
            
            // æ›´æ–°å¥–é¡¹é€‰æ‹©ä¸‹æ‹‰æ¡†
            function updatePrizeSelect() {
                prizeTypeSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©å¥–é¡¹ --</option>';
                
                prizes.forEach(prize => {
                    const option = document.createElement('option');
                    option.value = prize.id;
                    option.textContent = `${prize.name} (${prize.count}å)`;
                    prizeTypeSelect.appendChild(option);
                });
            }
            
            // ä¿å­˜è®¾ç½®
            setupBtn.addEventListener('click', function() {
                const names = participantsTextarea.value.split('\n')
                    .map(name => name.trim())
                    .filter(name => name !== '');
                
                if (names.length === 0) {
                    alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªå‚ä¸è€…åå­—ï¼');
                    return;
                }
                
                participants = names;
                alert(`æˆåŠŸå¯¼å…¥ ${participants.length} åå‚ä¸è€…ï¼`);
            });
            
            // æ·»åŠ å¥–é¡¹æŒ‰é’®
            addPrizeBtn.addEventListener('click', function() {
                const name = prizeNameInput.value.trim();
                const count = parseInt(prizeCountInput.value);
                const desc = prizeDescInput.value.trim();
                
                if (!name) {
                    alert('è¯·è¾“å…¥å¥–é¡¹åç§°ï¼');
                    return;
                }
                
                if (isNaN(count) || count < 1) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„äººæ•°ï¼');
                    return;
                }
                
                addPrize(name, count, desc);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                prizeNameInput.value = '';
                prizeCountInput.value = '';
                prizeDescInput.value = '';
            });
            
            // å¼€å§‹æŠ½å¥–
            startLotteryBtn.addEventListener('click', function() {
                if (participants.length === 0) {
                    alert('è¯·å…ˆå¯¼å…¥å‚ä¸è€…åå•ï¼');
                    return;
                }
                
                const selectedPrizeId = prizeTypeSelect.value;
                if (!selectedPrizeId) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå¥–é¡¹ï¼');
                    return;
                }
                
                if (isSpinning) return;
                
                // è·å–é€‰ä¸­çš„å¥–é¡¹
                const prize = prizes.find(p => p.id == selectedPrizeId);
                if (!prize) return;
                
                // æ£€æŸ¥å‰©ä½™å‚ä¸è€…æ˜¯å¦è¶³å¤Ÿ
                if (participants.length < prize.count) {
                    alert(`å‰©ä½™å‚ä¸è€…ä¸è¶³ï¼Œæ— æ³•æŠ½å– ${prize.count} åè·å¥–è€…ï¼`);
                    return;
                }
                
                // å¼€å§‹åŠ¨ç”»
                isSpinning = true;
                startLotteryBtn.classList.add('spinning');
                resultDisplay.textContent = 'æŠ½å¥–ä¸­...';
                resultDisplay.classList.add('blinking');
                
                // æ¨¡æ‹ŸæŠ½å¥–è¿‡ç¨‹
                setTimeout(() => {
                    // åœæ­¢åŠ¨ç”»
                    startLotteryBtn.classList.remove('spinning');
                    resultDisplay.classList.remove('blinking');
                    
                    // æŠ½å–è·å¥–è€…
                    const currentWinners = [];
                    for (let i = 0; i < prize.count; i++) {
                        const randomIndex = Math.floor(Math.random() * participants.length);
                        const winner = participants.splice(randomIndex, 1)[0];
                        currentWinners.push(winner);
                        
                        // æ·»åŠ åˆ°æ€»è·å¥–åå•
                        winners.push({
                            name: winner,
                            prize: prize.name,
                            prizeDesc: prize.desc
                        });
                    }
                    
                    // æ˜¾ç¤ºç»“æœï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
                    resultDisplay.innerHTML = `<span class="highlight">${currentWinners.join('ï¼Œ')}</span>`;
                    
                    // æ›´æ–°è·å¥–åå•æ˜¾ç¤º
                    updateWinnersList();
                    
                    isSpinning = false;
                }, 2000);
            });
            
            // æ‰¹é‡æŠ½å¥–
            batchDrawBtn.addEventListener('click', function() {
                if (participants.length === 0) {
                    alert('è¯·å…ˆå¯¼å…¥å‚ä¸è€…åå•ï¼');
                    return;
                }
                
                batchModal.style.display = 'flex';
            });
            
            // ç¡®è®¤æ‰¹é‡æŠ½å¥–
            confirmBatchDraw.addEventListener('click', function() {
                const count = parseInt(batchCountInput.value);
                const prizeName = batchPrizeInput.value.trim();
                
                if (isNaN(count) || count < 1) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ½å–äººæ•°ï¼');
                    return;
                }
                
                if (!prizeName) {
                    alert('è¯·è¾“å…¥å¥–é¡¹åç§°ï¼');
                    return;
                }
                
                if (participants.length < count) {
                    alert(`å‰©ä½™å‚ä¸è€…ä¸è¶³ï¼Œæ— æ³•æŠ½å– ${count} åè·å¥–è€…ï¼`);
                    return;
                }
                
                batchModal.style.display = 'none';
                
                // å¼€å§‹åŠ¨ç”»
                isSpinning = true;
                startLotteryBtn.classList.add('spinning');
                resultDisplay.textContent = 'æŠ½å¥–ä¸­...';
                resultDisplay.classList.add('blinking');
                
                // æ¨¡æ‹ŸæŠ½å¥–è¿‡ç¨‹
                setTimeout(() => {
                    // åœæ­¢åŠ¨ç”»
                    startLotteryBtn.classList.remove('spinning');
                    resultDisplay.classList.remove('blinking');
                    
                    // æŠ½å–è·å¥–è€…
                    const currentWinners = [];
                    for (let i = 0; i < count; i++) {
                        const randomIndex = Math.floor(Math.random() * participants.length);
                        const winner = participants.splice(randomIndex, 1)[0];
                        currentWinners.push(winner);
                        
                        // æ·»åŠ åˆ°æ€»è·å¥–åå•
                        winners.push({
                            name: winner,
                            prize: prizeName
                        });
                    }
                    
                    // æ˜¾ç¤ºç»“æœï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
                    resultDisplay.innerHTML = `<span class="highlight">${currentWinners.join('ï¼Œ')}</span>`;
                    
                    // æ›´æ–°è·å¥–åå•æ˜¾ç¤º
                    updateWinnersList();
                    
                    isSpinning = false;
                }, 2000);
            });
            
            // å–æ¶ˆæ‰¹é‡æŠ½å¥–
            cancelBatchDraw.addEventListener('click', function() {
                batchModal.style.display = 'none';
            });
            
            // æ›´æ–°è·å¥–åå•ï¼ˆæŒ‰å¥–é¡¹åˆ†ç»„ï¼Œæ¯äººä¸€è¡Œï¼‰
            function updateWinnersList() {
                winnersContainer.innerHTML = '';
                
                if (winners.length === 0) {
                    winnersContainer.innerHTML = `
                        <div class="winner-group">
                            <div class="winner-group-title">
                                <span>æš‚æ— ä¸­å¥–è€…</span>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // æŒ‰å¥–é¡¹åˆ†ç»„
                const groupedWinners = {};
                winners.forEach(winner => {
                    if (!groupedWinners[winner.prize]) {
                        groupedWinners[winner.prize] = [];
                    }
                    groupedWinners[winner.prize].push(winner);
                });
                
                // æ¸²æŸ“åˆ†ç»„åçš„è·å¥–åå•
                for (const prize in groupedWinners) {
                    const winnerGroup = document.createElement('div');
                    winnerGroup.className = 'winner-group';
                    
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'winner-group-title';
                    groupTitle.innerHTML = `
                        <span>${prize}</span>
                        <span class="prize-tag">${groupedWinners[prize].length}äºº</span>
                    `;
                    
                    const winnerItems = document.createElement('div');
                    winnerItems.className = 'winner-items';
                    
                    // æ¯ä¸ªä¸­å¥–è€…å•ç‹¬ä¸€è¡Œ
                    groupedWinners[prize].forEach(winner => {
                        const winnerItem = document.createElement('div');
                        winnerItem.className = 'winner-item';
                        winnerItem.innerHTML = `
                            <span>${winner.name}</span>
                            ${winner.prizeDesc ? `<span class="prize-tag">${winner.prizeDesc}</span>` : ''}
                        `;
                        winnerItems.appendChild(winnerItem);
                    });
                    
                    winnerGroup.appendChild(groupTitle);
                    winnerGroup.appendChild(winnerItems);
                    winnersContainer.appendChild(winnerGroup);
                }
            }
            
            // é‡ç½®æŠ½å¥–
            resetBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é‡ç½®æŠ½å¥–å—ï¼Ÿè¿™å°†æ¸…ç©ºæ‰€æœ‰å·²æŠ½å–çš„è·å¥–è€…ï¼')) {
                    participants = participantsTextarea.value.split('\n')
                        .map(name => name.trim())
                        .filter(name => name !== '');
                    winners = [];
                    resultDisplay.textContent = 'ç­‰å¾…æŠ½å¥–ç»“æœ...';
                    updateWinnersList();
                }
            });
            
            // å¯¼å‡ºExcel
            exportBtn.addEventListener('click', function() {
                if (winners.length === 0) {
                    alert('æš‚æ— æŠ½å¥–ç»“æœå¯å¯¼å‡ºï¼');
                    return;
                }
                
                // å‡†å¤‡Excelæ•°æ®
                const data = [['å§“å', 'å¥–é¡¹', 'å¥–å“æè¿°']];
                
                winners.forEach(winner => {
                    data.push([winner.name, winner.prize, winner.prizeDesc || '']);
                });
                
                // åˆ›å»ºå·¥ä½œç°¿
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ä¸­å¥–åå•');
                
                // å¯¼å‡ºExcelæ–‡ä»¶
                XLSX.writeFile(wb, 'æŠ½å¥–ç»“æœ.xlsx');
            });
        });
    </script>
</body>
</html>